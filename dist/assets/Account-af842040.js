import{c as v,r as I,j as e,N as T,t as f}from"./index-692334f1.js";import{u as _}from"./index-1185bc7d.js";import{r as c,t as o,a as U,u as D,f as F,c as S}from"./index-55eef685.js";import{s as h,C as g,a as C,b as A,e as p,B as V}from"./supabase-client-5015c98a.js";import{A as z,a as B,b as $,c as P,d as K,e as Y,j as O,f as Q}from"./alert-dialog-0254d15d.js";import{M as R}from"./mail-ce481569.js";import{C as W}from"./clock-29e84137.js";import{d as G,i as J}from"./index-6dbaa3ae.js";const X=v("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Z=v("UserCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),k=v("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var L=36e5;function q(s,t){var r=s.getFullYear()-t.getFullYear()||s.getMonth()-t.getMonth()||s.getDate()-t.getDate()||s.getHours()-t.getHours()||s.getMinutes()-t.getMinutes()||s.getSeconds()-t.getSeconds()||s.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function ee(s,t){c(2,arguments);var r=o(s),a=o(t),l=q(r,a),d=Math.abs(G(r,a));r.setDate(r.getDate()-l*d);var x=+(q(r,a)===-l),u=l*(d-x);return u===0?0:u}function se(s,t){return c(2,arguments),o(s).getTime()-o(t).getTime()}var H={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},te="trunc";function re(s){return s?H[s]:H[te]}function ae(s,t,r){c(2,arguments);var a=se(s,t)/L;return re(r==null?void 0:r.roundingMethod)(a)}function ne(s,t){c(2,arguments);var r=o(s),a=U(t);return r.setHours(a),r}function ie(s,t){c(2,arguments);var r=o(s),a=U(t);return r.setMinutes(a),r}function he(){var j,y,N;const{user:s}=_(),[t,r]=I.useState(null),{data:a}=D({queryKey:["profile",s==null?void 0:s.id],queryFn:async()=>{const{data:n,error:i}=await h.from("profiles").select("*").eq("id",s==null?void 0:s.id).single();if(i)throw i;return n},enabled:!!(s!=null&&s.id)}),{data:l,refetch:d}=D({queryKey:["user-bookings",s==null?void 0:s.id],queryFn:async()=>{const{data:n,error:i}=await h.from("bookings").select(`
          *,
          slots (
            date
          )
        `).eq("user_id",s==null?void 0:s.id).order("created_at",{ascending:!1});if(i)throw i;return n},enabled:!!(s!=null&&s.id)}),x=async n=>{try{const{error:i}=await h.from("bookings").delete().eq("id",n);if(i){console.error("Error deleting booking:",i),f({title:"Erreur",description:"Une erreur est survenue lors de l'annulation",variant:"destructive"});return}f({title:"Réservation annulée",description:"Votre réservation a été annulée avec succès"}),d()}catch(i){console.error("Error canceling booking:",i),f({title:"Erreur",description:"Une erreur est survenue lors de l'annulation",variant:"destructive"})}finally{r(null)}},u=n=>n===1?"Motocross":"Supercross",E=n=>{const i=new Date,M=new Date(n),b=ie(ne(M,14),0),m=ee(b,i),w=ae(b,i);return J(i,M)?"⚠️ Attention : Vous annulez une réservation pour aujourd'hui. Cette annulation tardive peut impacter l'organisation.":m<1?`⚠️ Attention : Vous annulez une réservation prévue dans ${w} heure${w>1?"s":""}.`:m<=2?`⚠️ Attention : Vous annulez une réservation prévue dans ${m} jour${m>1?"s":""}.`:null};return s?e.jsxs("div",{className:"container mx-auto px-4 py-6 md:py-8 max-w-4xl",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6 md:mb-8",children:"Mon compte"}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs(g,{className:"w-full",children:[e.jsx(C,{children:e.jsxs(A,{className:"text-xl md:text-2xl flex items-center gap-2",children:[e.jsx(Z,{className:"h-6 w-6"}),"Mon profil"]})}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Prénom"}),e.jsx("p",{className:"text-muted-foreground",children:(a==null?void 0:a.first_name)||"Non renseigné"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Nom"}),e.jsx("p",{className:"text-muted-foreground",children:(a==null?void 0:a.last_name)||"Non renseigné"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 md:col-span-2",children:[e.jsx(R,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Email"}),e.jsx("p",{className:"text-muted-foreground",children:a==null?void 0:a.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3 md:col-span-2 pt-2 border-t",children:[e.jsx(X,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pour modifier vos informations, veuillez nous contacter via le formulaire de contact."})]})]})})]}),e.jsxs(g,{className:"w-full",children:[e.jsx(C,{children:e.jsx(A,{className:"text-xl md:text-2xl",children:"Mes réservations"})}),e.jsx(p,{children:!l||l.length===0?e.jsx("p",{className:"text-muted-foreground",children:"Vous n'avez pas encore de réservation."}):e.jsx("div",{className:"space-y-4",children:l.map(n=>e.jsx(g,{className:"overflow-hidden",children:e.jsx(p,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-base md:text-lg",children:["Circuit : ",u(n.circuit_number)]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Date :"," ",F(new Date(n.slots.date),"d MMMM yyyy",{locale:S})]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"14h00 - 18h00"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nombre de pilotes : ",n.number_of_pilots]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Statut : vérifié"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paiement : sur place"})]})]}),e.jsx(V,{variant:"destructive",onClick:()=>r(n.id),className:"w-full md:w-auto bg-red-600 hover:bg-red-700 text-white",children:"Annuler ma réservation"})]})})},n.id))})})]})]}),e.jsx(z,{open:!!t,onOpenChange:()=>r(null),children:e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(P,{children:"Confirmer l'annulation"}),e.jsxs(K,{className:"space-y-4",children:[e.jsx("p",{children:"Êtes-vous sûr de vouloir annuler cette réservation ?"}),t&&((y=(j=l==null?void 0:l.find(n=>n.id===t))==null?void 0:j.slots)==null?void 0:y.date)&&e.jsx("p",{className:"text-yellow-600 dark:text-yellow-500",children:E((N=l.find(n=>n.id===t))==null?void 0:N.slots.date)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette action est irréversible."})]})]}),e.jsxs(Y,{children:[e.jsx(O,{children:"Annuler"}),e.jsx(Q,{onClick:()=>t&&x(t),className:"bg-red-600 hover:bg-red-700 text-white",children:"Confirmer l'annulation"})]})]})})]}):e.jsx(T,{to:"/auth"})}export{he as default};
//# sourceMappingURL=Account-af842040.js.map
