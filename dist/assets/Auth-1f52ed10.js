import{c as M,r as t,u as A,j as e,t as i}from"./index-692334f1.js";import{T as R,a as O,b as k,c as T}from"./tabs-04bc6101.js";import{c as J,C as N,a as b,b as C,d as E,e as S,B as w,f as $,s as F}from"./supabase-client-5015c98a.js";import{F as V}from"./form-99120a69.js";import{I as f,L as g}from"./input-f321aa22.js";import{u as H}from"./index-1185bc7d.js";import{A as X,a as Z,b as B,c as G,d as W,e as Y,f as _}from"./alert-dialog-0254d15d.js";import"./index-99ccf18f.js";const K=M("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Q="https://sgnnmtyxhjphdfqxbqsc.supabase.co",ee="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnbm5tdHl4aGpwaGRmcXhicXNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgzMjkyMjgsImV4cCI6MjA1MzkwNTIyOH0.Ikbj3qCuX1tuWBwOvncwEj_ZmqxAci5HItursMCLyEU",L=J(Q,ee);function se(){const[v,s]=t.useState(null),[l,r]=t.useState(!0),d=A();return t.useEffect(()=>{L.auth.getSession().then(({data:{session:n}})=>{s((n==null?void 0:n.user)??null),r(!1)});const{data:{subscription:p}}=L.auth.onAuthStateChange((n,a)=>{s((a==null?void 0:a.user)??null)});return()=>p.unsubscribe()},[]),{user:v,loading:l,signIn:async(p,n)=>{const{error:a}=await L.auth.signInWithPassword({email:p,password:n});if(a)throw a;d("/dashboard")},signOut:async()=>{const{error:p}=await L.auth.signOut();if(p)throw p;d("/")}}}function te({onForgotPasswordClick:v}){const[s,l]=t.useState(""),[r,d]=t.useState(""),[u,m]=t.useState(!1),{signIn:p}=se(),n=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),a=async o=>{if(o.preventDefault(),!n(s)){i({variant:"destructive",title:"Erreur",description:"Veuillez entrer une adresse email valide"});return}if(!r){i({variant:"destructive",title:"Erreur",description:"Veuillez entrer votre mot de passe"});return}try{m(!0),await p(s,r)}catch{i({variant:"destructive",title:"Erreur de connexion",description:"Email ou mot de passe incorrect"})}finally{m(!1)}};return e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsx(C,{children:"Connexion"}),e.jsx(E,{children:"Connectez-vous pour accéder à votre compte"})]}),e.jsx(S,{children:e.jsxs("form",{onSubmit:a,className:"space-y-4",role:"form",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",type:"email",placeholder:"exemple@email.com",value:s,onChange:o=>l(o.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"password",children:"Mot de passe"}),e.jsx(f,{id:"password",type:"password",placeholder:"••••••••",value:r,onChange:o=>d(o.target.value),required:!0})]}),e.jsx(w,{type:"submit",className:"w-full",disabled:u,children:u?"Connexion...":"Se connecter"}),e.jsx(w,{type:"button",variant:"link",className:"w-full",onClick:v,children:"Mot de passe oublié ?"})]})})]})}function re({onSuccess:v}){const{signUp:s}=H(),[l,r]=t.useState(!1),[d,u]=t.useState(""),[m,p]=t.useState(""),[n,a]=t.useState(""),[o,c]=t.useState(""),[y,j]=t.useState(!1),x=h=>h.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/),P=h=>{const I=/[A-Z]/.test(h),z=[];return h.length<6&&z.push("Le mot de passe doit contenir au moins 6 caractères"),I||z.push("Le mot de passe doit contenir au moins une majuscule"),z},D=async h=>{if(h.preventDefault(),!d||!m||!n||!o){i({variant:"destructive",title:"Erreur",description:"Veuillez remplir tous les champs"});return}if(!x(d)){i({variant:"destructive",title:"Erreur",description:"Veuillez entrer une adresse email valide"});return}if(P(m).length>0){i({variant:"destructive",title:"Erreur",description:"Le mot de passe doit contenir au moins 6 caractères et une majuscule"});return}try{r(!0),await s(d,m,n,o),u(""),p(""),a(""),c(""),j(!0)}catch(I){I.message.includes("rate limit")?i({variant:"destructive",title:"Erreur",description:"Trop de tentatives. Veuillez réessayer plus tard."}):i({variant:"destructive",title:"Erreur",description:I.message||"Une erreur est survenue lors de l'inscription"})}finally{r(!1)}},q=()=>{j(!1),v()};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{className:"w-full",children:[e.jsxs(b,{className:"space-y-1",children:[e.jsx(C,{className:"text-2xl",children:"Inscription"}),e.jsx(E,{children:"Créez votre compte pour commencer à réserver des sessions"})]}),e.jsxs("form",{onSubmit:D,role:"form",children:[e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"signup-firstname",children:"Prénom"}),e.jsx(f,{id:"signup-firstname",value:n,onChange:h=>a(h.target.value),disabled:l,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"signup-lastname",children:"Nom"}),e.jsx(f,{id:"signup-lastname",value:o,onChange:h=>c(h.target.value),disabled:l,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"signup-email",children:"Email"}),e.jsx(f,{id:"signup-email",type:"email",value:d,onChange:h=>u(h.target.value),disabled:l,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{htmlFor:"signup-password",children:"Mot de passe"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"(6 caractères et 1 majuscule minimum)"})]}),e.jsx(f,{id:"signup-password",type:"password",value:m,onChange:h=>p(h.target.value),disabled:l,required:!0})]})]}),e.jsx($,{children:e.jsx(w,{type:"submit",className:"w-full",disabled:l,children:l?"Inscription...":"S'inscrire"})})]})]}),e.jsx(X,{open:y,onOpenChange:j,children:e.jsxs(Z,{children:[e.jsxs(B,{children:[e.jsx(G,{children:"Vérifiez votre boîte mail"}),e.jsx(W,{children:"Un email de confirmation vous a été envoyé. Veuillez cliquer sur le lien dans l'email pour activer votre compte."})]}),e.jsx(Y,{children:e.jsx(_,{onClick:q,children:"Compris"})})]})})]})}function ae({onBack:v}){const[s,l]=t.useState(""),[r,d]=t.useState(!1),[u,m]=t.useState(0),p=a=>a.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/),n=async a=>{if(a.preventDefault(),!s.trim()){i({variant:"destructive",title:"Erreur",description:"Veuillez entrer votre adresse email"});return}if(!p(s)){i({variant:"destructive",title:"Erreur",description:"Veuillez entrer une adresse email valide"});return}const o=Date.now();if(o-u<6e4){i({variant:"destructive",title:"Erreur",description:"Veuillez patienter une minute avant de réessayer"});return}d(!0);try{const{error:c}=await F.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/auth/reset-password`});if(c)throw c.message.includes("rate limit")?new Error("Trop de tentatives. Veuillez réessayer plus tard."):c;m(o),i({title:"Email envoyé",description:"Si un compte existe avec cette adresse email, vous recevrez un lien de réinitialisation."}),setTimeout(()=>{v()},2e3)}catch(c){i({variant:"destructive",title:"Erreur",description:c.message||"Une erreur est survenue lors de l'envoi de l'email"})}finally{d(!1)}};return e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsxs(w,{variant:"ghost",className:"w-fit h-fit p-0 mb-4",onClick:v,children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),"Retour"]}),e.jsx(C,{children:"Mot de passe oublié"}),e.jsx(E,{children:"Entrez votre adresse email pour recevoir un lien de réinitialisation"})]}),e.jsx(S,{children:e.jsxs("form",{onSubmit:n,className:"space-y-4",role:"form",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"reset-email",children:"Email"}),e.jsx(f,{id:"reset-email",type:"email",placeholder:"exemple@email.com",value:s,onChange:a=>l(a.target.value),disabled:r,required:!0})]}),e.jsx(w,{type:"submit",className:"w-full",disabled:r,children:r?"Envoi en cours...":"Envoyer le lien"})]})})]})}function ie(){const v=A(),[s,l]=t.useState(""),[r,d]=t.useState(""),[u,m]=t.useState(!1),[p,n]=t.useState(!1);t.useEffect(()=>{(async()=>{const y=window.location.hash;if(!y){n(!0);return}try{const j=y.split("=")[1],{error:x}=await F.auth.getUser(j);x&&(n(!0),i({variant:"destructive",title:"Lien expiré",description:"Ce lien de réinitialisation n'est plus valide. Veuillez en demander un nouveau."}))}catch{n(!0)}})()},[]);const a=()=>{v("/auth",{state:{showForgotPassword:!0}})},o=async c=>{if(c.preventDefault(),!s||!r){i({variant:"destructive",title:"Erreur",description:"Veuillez remplir tous les champs"});return}const y=6,j=/[A-Z]/.test(s);if(s.length<y||!j){i({variant:"destructive",title:"Erreur",description:"Le mot de passe doit contenir au moins 6 caractères et une majuscule"});return}if(s!==r){i({variant:"destructive",title:"Erreur",description:"Les mots de passe ne correspondent pas"});return}m(!0);try{const{error:x}=await F.auth.updateUser({password:s});if(x)throw x.message.includes("rate limit")?new Error("Trop de tentatives. Veuillez réessayer plus tard."):x;i({title:"Succès",description:"Votre mot de passe a été mis à jour. Vous allez être redirigé vers la page de connexion."}),setTimeout(()=>{v("/auth")},2e3)}catch(x){i({variant:"destructive",title:"Erreur",description:x.message||"Une erreur est survenue lors de la mise à jour du mot de passe"})}finally{m(!1)}};return p?e.jsxs(N,{className:"w-full",children:[e.jsxs(b,{className:"space-y-1",children:[e.jsx(C,{className:"text-2xl",children:"Lien expiré"}),e.jsx(E,{children:"Ce lien de réinitialisation n'est plus valide. Vous pouvez demander un nouveau lien pour réinitialiser votre mot de passe."})]}),e.jsx(S,{children:e.jsx(w,{onClick:a,className:"w-full",children:"Demander un nouveau lien"})})]}):e.jsxs(N,{className:"w-full",children:[e.jsxs(b,{className:"space-y-1",children:[e.jsx(C,{className:"text-2xl",children:"Réinitialisation du mot de passe"}),e.jsx(E,{children:"Choisissez un nouveau mot de passe pour votre compte"})]}),e.jsx(S,{children:e.jsxs("form",{onSubmit:o,role:"form",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{htmlFor:"new-password",children:"Nouveau mot de passe"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"(6 caractères et 1 majuscule minimum)"})]}),e.jsx(f,{id:"new-password",type:"password",value:s,onChange:c=>l(c.target.value),disabled:u,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"confirm-password",children:"Confirmer le mot de passe"}),e.jsx(f,{id:"confirm-password",type:"password",value:r,onChange:c=>d(c.target.value),disabled:u,required:!0})]}),e.jsx(w,{type:"submit",className:"w-full",disabled:u,children:u?"Mise à jour...":"Mettre à jour le mot de passe"})]})})]})}function he(){const[v,s]=t.useState(!1),[l,r]=t.useState("signin");if(A(),window.location.pathname.includes("reset-password"))return e.jsx("div",{className:"flex min-h-[calc(100vh-4rem)] items-center justify-center p-4 md:p-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(ie,{})})});const u=()=>{s(!0)},m=()=>{s(!1)};return v?e.jsx("div",{className:"flex min-h-[calc(100vh-4rem)] items-center justify-center p-4 md:p-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(ae,{onBack:m})})}):e.jsx("div",{className:"flex min-h-[calc(100vh-4rem)] items-center justify-center p-4 md:p-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(R,{defaultValue:l,onValueChange:r,className:"w-full",children:[e.jsxs(O,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(k,{value:"signin",children:"Connexion"}),e.jsx(k,{value:"signup",children:"Inscription"})]}),e.jsx(T,{value:"signin",className:"mt-0",children:e.jsx(te,{onForgotPasswordClick:u})}),e.jsx(T,{value:"signup",className:"mt-0",children:e.jsx(re,{onSuccess:()=>r("signin")})})]})})})}export{he as default};
//# sourceMappingURL=Auth-1f52ed10.js.map
